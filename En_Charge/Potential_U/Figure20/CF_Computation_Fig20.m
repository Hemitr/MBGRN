clear all

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% Computation of cogging force using MST %%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% MST : Maxwell stress tensor

load FichInduc

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% Spatial distribution of B components over one pole pair %%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

x0  = [l/2:l:tp-l/2];
x1 = [tp+l/2:l:2*tp-l/2];
for i=1:length(xd)
    for j=1:length(x1)
        Bx(length(x0)+j,i)=-Bx(j,i);
        By(length(x0)+j,i)=-By(j,i);
    end
end

%%%%%%%%%%%%%%%%%%
%%% MST method %%%
%%%%%%%%%%%%%%%%%%
x2  = [l/2:l:2*tp-l/2];
for i=1:length(xd)
    for j=1:length(x2)
        ProdInd(i,j)  = Bx(j,i)*By(j,i);
    end
    ForDet(i)=0;
    for j=1:length(x2)-1
        ForDet(i)  = ForDet(i)+(ProdInd(i,j+1)+ProdInd(i,j))*l/2/mu0;
    end
end

%%%%%%%%%%%%%%%%%%%%%%
%%% Flux2D results %%%
%%%%%%%%%%%%%%%%%%%%%%

FD = [0.00000000E+00      4.25436065E+03
      5.00000000E-04      4.14855825E+03
      1.00000000E-03      4.02081342E+03
      1.50000000E-03      3.85222228E+03
      2.00000000E-03      3.61530746E+03
      2.50000000E-03      3.28506983E+03
      3.00000000E-03      2.90505779E+03
      3.50000000E-03      2.54915773E+03
      4.00000000E-03      2.25862302E+03
      4.50000000E-03      2.03825255E+03
      5.00000000E-03      1.88068283E+03
      5.50000000E-03      1.77711051E+03
      6.00000000E-03      1.71964926E+03
      6.50000000E-03      1.70248439E+03
      7.00000000E-03      1.72424684E+03
      7.50000000E-03      1.79626492E+03
      8.00000000E-03      1.94543984E+03
      8.50000000E-03      2.18145115E+03
      9.00000000E-03      2.49102628E+03
      9.50000000E-03      2.85382097E+03
      1.00000000E-02      3.25104065E+03
      1.05000000E-02      3.66541015E+03
      1.10000000E-02      4.07952978E+03
      1.15000000E-02      4.47365667E+03
      1.20000000E-02      4.82291616E+03
      1.25000000E-02      5.10099083E+03
      1.30000000E-02      5.29947172E+03
      1.35000000E-02      5.43737904E+03
      1.40000000E-02      5.53322235E+03
      1.45000000E-02      5.59203175E+03
      1.50000000E-02      5.61197894E+03
      1.55000000E-02      5.58765082E+03
      1.60000000E-02      5.51152776E+03
      1.65000000E-02      5.37577859E+03
      1.70000000E-02      5.17973756E+03
      1.75000000E-02      4.94863479E+03
      1.80000000E-02      4.73519185E+03
      1.85000000E-02      4.57524511E+03
      1.90000000E-02      4.45400178E+03
      1.95000000E-02      4.35199804E+03
      2.00000000E-02      4.25436065E+03];

figure
plot(FD(:,1)*1000,FD(:,2),'o')
hold on
plot(xd*1000,ForDet)

% The results from the FEM have been obtained for one pole pair