clear all

%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% Computation of EMF %%%
%%%%%%%%%%%%%%%%%%%%%%%%%%

load FichFlux

xd1 = [tp/2+l:l:tp];
for i=1:length(xd1)
    FluxC1(i)           = FluxC(length(xd)-i);
    FluxC(length(xd)+i) = FluxC1(i);
end
xd2 = [0:l:tp];
xd3 = [tp+l:l:2*tp];
for i=1:length(xd3)
    FluxC(length(xd2)+i) = -FluxC(i+1);
end
xd4 = [0:l:2*tp];

for i=1:length(xd4)-1
    FEMC(i) = (FluxC(i+1)-FluxC(i))*1/0.5e-3;
end
FEMC(length(xd4)) = FEMC(1);

%%%%%%%%%%%%%%%%%%%%%%
%%% Flux2D results %%%
%%%%%%%%%%%%%%%%%%%%%%

V =  [0.00000000E+00      0.00000000E+00      0.00000000E+00      0.00000000E+00
      1.00000000E+00      2.06724591E-02      5.38017488E-04      1.96216625E-02
      2.00000000E+00      5.20482688E-04      5.37546236E-04     -5.28060696E-04
      3.00000000E+00      5.15010955E-04      5.36481517E-04     -5.28517111E-04
      4.00000000E+00      5.06775625E-04      5.34544491E-04     -5.27805247E-04
      5.00000000E+00      4.94133267E-04      5.31248005E-04     -5.25498872E-04
      6.00000000E+00      4.76062873E-04      5.26411609E-04     -5.21466460E-04
      7.00000000E+00      4.53962080E-04      5.20781874E-04     -5.16506216E-04
      8.00000000E+00      4.30025757E-04      5.15268360E-04     -5.11568810E-04
      9.00000000E+00      4.05479835E-04      5.10301327E-04     -5.07108230E-04
      1.00000000E+01      3.80652891E-04      5.05953779E-04     -5.03210717E-04
      1.10000000E+01      3.55448823E-04      5.02154701E-04     -4.99813698E-04
      1.20000000E+01      3.29521890E-04      4.98764472E-04     -4.96783392E-04
      1.30000000E+01      3.02242201E-04      4.95566014E-04     -4.93906335E-04
      1.40000000E+01      2.72544205E-04      4.92217990E-04     -4.90842375E-04
      1.50000000E+01      2.38719577E-04      4.88195427E-04     -4.87064954E-04
      1.60000000E+01      1.99697801E-04      4.83300147E-04     -4.82380718E-04
      1.70000000E+01      1.56842913E-04      4.78279047E-04     -4.77556026E-04
      1.80000000E+01      1.12335375E-04      4.74060129E-04     -4.73535786E-04
      1.90000000E+01      6.74140153E-05      4.71112345E-04     -4.70793958E-04
      2.00000000E+01      2.24655047E-05      4.69572353E-04     -4.69465560E-04
      2.10000000E+01     -2.24655047E-05      4.69465560E-04     -4.69572353E-04
      2.20000000E+01     -6.74140153E-05      4.70793958E-04     -4.71112345E-04
      2.30000000E+01     -1.12335375E-04      4.73535786E-04     -4.74060129E-04
      2.40000000E+01     -1.56842913E-04      4.77556026E-04     -4.78279047E-04
      2.50000000E+01     -1.99697801E-04      4.82380718E-04     -4.83300147E-04
      2.60000000E+01     -2.38719577E-04      4.87064954E-04     -4.88195427E-04
      2.70000000E+01     -2.72544205E-04      4.90842375E-04     -4.92217990E-04
      2.80000000E+01     -3.02242201E-04      4.93906335E-04     -4.95566014E-04
      2.90000000E+01     -3.29521890E-04      4.96783392E-04     -4.98764472E-04
      3.00000000E+01     -3.55448823E-04      4.99813698E-04     -5.02154701E-04
      3.10000000E+01     -3.80652891E-04      5.03210717E-04     -5.05953779E-04
      3.20000000E+01     -4.05479835E-04      5.07108230E-04     -5.10301327E-04
      3.30000000E+01     -4.30025757E-04      5.11568810E-04     -5.15268360E-04
      3.40000000E+01     -4.53962080E-04      5.16506216E-04     -5.20781874E-04
      3.50000000E+01     -4.76062873E-04      5.21466460E-04     -5.26411609E-04
      3.60000000E+01     -4.94133267E-04      5.25498872E-04     -5.31248005E-04
      3.70000000E+01     -5.06775625E-04      5.27805247E-04     -5.34544491E-04
      3.80000000E+01     -5.15010955E-04      5.28517111E-04     -5.36481517E-04
      3.90000000E+01     -5.20482688E-04      5.28060696E-04     -5.37546236E-04
      4.00000000E+01     -5.24175266E-04      5.26621372E-04     -5.38017488E-04
      4.10000000E+01     -5.26621372E-04      5.24175266E-04     -5.38017488E-04
      4.20000000E+01     -5.28060696E-04      5.20482688E-04     -5.37546236E-04
      4.30000000E+01     -5.28517111E-04      5.15010955E-04     -5.36481517E-04
      4.40000000E+01     -5.27805247E-04      5.06775625E-04     -5.34544491E-04
      4.50000000E+01     -5.25498872E-04      4.94133267E-04     -5.31248005E-04
      4.60000000E+01     -5.21466460E-04      4.76062873E-04     -5.26411609E-04
      4.70000000E+01     -5.16506216E-04      4.53962080E-04     -5.20781874E-04
      4.80000000E+01     -5.11568810E-04      4.30025757E-04     -5.15268360E-04
      4.90000000E+01     -5.07108230E-04      4.05479835E-04     -5.10301327E-04
      5.00000000E+01     -5.03210717E-04      3.80652891E-04     -5.05953779E-04
      5.10000000E+01     -4.99813698E-04      3.55448823E-04     -5.02154701E-04
      5.20000000E+01     -4.96783392E-04      3.29521890E-04     -4.98764472E-04
      5.30000000E+01     -4.93906335E-04      3.02242201E-04     -4.95566014E-04
      5.40000000E+01     -4.90842375E-04      2.72544205E-04     -4.92217990E-04
      5.50000000E+01     -4.87064954E-04      2.38719577E-04     -4.88195427E-04
      5.60000000E+01     -4.82380718E-04      1.99697801E-04     -4.83300147E-04
      5.70000000E+01     -4.77556026E-04      1.56842913E-04     -4.78279047E-04
      5.80000000E+01     -4.73535786E-04      1.12335375E-04     -4.74060129E-04
      5.90000000E+01     -4.70793958E-04      6.74140153E-05     -4.71112345E-04
      6.00000000E+01     -4.69465560E-04      2.24655047E-05     -4.69572353E-04
      6.10000000E+01     -4.69572353E-04     -2.24655047E-05     -4.69465560E-04
      6.20000000E+01     -4.71112345E-04     -6.74140153E-05     -4.70793958E-04
      6.30000000E+01     -4.74060129E-04     -1.12335375E-04     -4.73535786E-04
      6.40000000E+01     -4.78279047E-04     -1.56842913E-04     -4.77556026E-04
      6.50000000E+01     -4.83300147E-04     -1.99697801E-04     -4.82380718E-04
      6.60000000E+01     -4.88195427E-04     -2.38719577E-04     -4.87064954E-04
      6.70000000E+01     -4.92217990E-04     -2.72544205E-04     -4.90842375E-04
      6.80000000E+01     -4.95566014E-04     -3.02242201E-04     -4.93906335E-04
      6.90000000E+01     -4.98764472E-04     -3.29521890E-04     -4.96783392E-04
      7.00000000E+01     -5.02154701E-04     -3.55448823E-04     -4.99813698E-04
      7.10000000E+01     -5.05953779E-04     -3.80652891E-04     -5.03210717E-04
      7.20000000E+01     -5.10301327E-04     -4.05479835E-04     -5.07108230E-04
      7.30000000E+01     -5.15268360E-04     -4.30025757E-04     -5.11568810E-04
      7.40000000E+01     -5.20781874E-04     -4.53962080E-04     -5.16506216E-04
      7.50000000E+01     -5.26411609E-04     -4.76062873E-04     -5.21466460E-04
      7.60000000E+01     -5.31248005E-04     -4.94133267E-04     -5.25498872E-04
      7.70000000E+01     -5.34544491E-04     -5.06775625E-04     -5.27805247E-04
      7.80000000E+01     -5.36481517E-04     -5.15010955E-04     -5.28517111E-04
      7.90000000E+01     -5.37546236E-04     -5.20482688E-04     -5.28060696E-04
      8.00000000E+01     -5.38017488E-04     -5.24175266E-04     -5.26621372E-04
      8.10000000E+01     -5.38017488E-04     -5.26621372E-04     -5.24175266E-04
      8.20000000E+01     -5.37546236E-04     -5.28060696E-04     -5.20482688E-04
      8.30000000E+01     -5.36481517E-04     -5.28517111E-04     -5.15010955E-04
      8.40000000E+01     -5.34544491E-04     -5.27805247E-04     -5.06775625E-04
      8.50000000E+01     -5.31248005E-04     -5.25498872E-04     -4.94133267E-04
      8.60000000E+01     -5.26411609E-04     -5.21466460E-04     -4.76062873E-04
      8.70000000E+01     -5.20781874E-04     -5.16506216E-04     -4.53962080E-04
      8.80000000E+01     -5.15268360E-04     -5.11568810E-04     -4.30025757E-04
      8.90000000E+01     -5.10301327E-04     -5.07108230E-04     -4.05479835E-04
      9.00000000E+01     -5.05953779E-04     -5.03210717E-04     -3.80652891E-04
      9.10000000E+01     -5.02154701E-04     -4.99813698E-04     -3.55448823E-04
      9.20000000E+01     -4.98764472E-04     -4.96783392E-04     -3.29521890E-04
      9.30000000E+01     -4.95566014E-04     -4.93906335E-04     -3.02242201E-04
      9.40000000E+01     -4.92217990E-04     -4.90842375E-04     -2.72544205E-04
      9.50000000E+01     -4.88195427E-04     -4.87064954E-04     -2.38719577E-04
      9.60000000E+01     -4.83300147E-04     -4.82380718E-04     -1.99697801E-04
      9.70000000E+01     -4.78279047E-04     -4.77556026E-04     -1.56842913E-04
      9.80000000E+01     -4.74060129E-04     -4.73535786E-04     -1.12335375E-04
      9.90000000E+01     -4.71112345E-04     -4.70793958E-04     -6.74140153E-05
      1.00000000E+02     -4.69572353E-04     -4.69465560E-04     -2.24655047E-05
      1.01000000E+02     -4.69465560E-04     -4.69572353E-04      2.24655047E-05
      1.02000000E+02     -4.70793958E-04     -4.71112345E-04      6.74140153E-05
      1.03000000E+02     -4.73535786E-04     -4.74060129E-04      1.12335375E-04
      1.04000000E+02     -4.77556026E-04     -4.78279047E-04      1.56842913E-04
      1.05000000E+02     -4.82380718E-04     -4.83300147E-04      1.99697801E-04
      1.06000000E+02     -4.87064954E-04     -4.88195427E-04      2.38719577E-04
      1.07000000E+02     -4.90842375E-04     -4.92217990E-04      2.72544205E-04
      1.08000000E+02     -4.93906335E-04     -4.95566014E-04      3.02242201E-04
      1.09000000E+02     -4.96783392E-04     -4.98764472E-04      3.29521890E-04
      1.10000000E+02     -4.99813698E-04     -5.02154701E-04      3.55448823E-04
      1.11000000E+02     -5.03210717E-04     -5.05953779E-04      3.80652891E-04
      1.12000000E+02     -5.07108230E-04     -5.10301327E-04      4.05479835E-04
      1.13000000E+02     -5.11568810E-04     -5.15268360E-04      4.30025757E-04
      1.14000000E+02     -5.16506216E-04     -5.20781874E-04      4.53962080E-04
      1.15000000E+02     -5.21466460E-04     -5.26411609E-04      4.76062873E-04
      1.16000000E+02     -5.25498872E-04     -5.31248005E-04      4.94133267E-04
      1.17000000E+02     -5.27805247E-04     -5.34544491E-04      5.06775625E-04
      1.18000000E+02     -5.28517111E-04     -5.36481517E-04      5.15010955E-04
      1.19000000E+02     -5.28060696E-04     -5.37546236E-04      5.20482688E-04
      1.20000000E+02     -5.26621372E-04     -5.38017488E-04      5.24175266E-04
      1.21000000E+02     -5.24175266E-04     -5.38017488E-04      5.26621372E-04
      1.22000000E+02     -5.20482688E-04     -5.37546236E-04      5.28060696E-04
      1.23000000E+02     -5.15010955E-04     -5.36481517E-04      5.28517111E-04
      1.24000000E+02     -5.06775625E-04     -5.34544491E-04      5.27805247E-04
      1.25000000E+02     -4.94133267E-04     -5.31248005E-04      5.25498872E-04
      1.26000000E+02     -4.76062873E-04     -5.26411609E-04      5.21466460E-04
      1.27000000E+02     -4.53962080E-04     -5.20781874E-04      5.16506216E-04
      1.28000000E+02     -4.30025757E-04     -5.15268360E-04      5.11568810E-04
      1.29000000E+02     -4.05479835E-04     -5.10301327E-04      5.07108230E-04
      1.30000000E+02     -3.80652891E-04     -5.05953779E-04      5.03210717E-04
      1.31000000E+02     -3.55448823E-04     -5.02154701E-04      4.99813698E-04
      1.32000000E+02     -3.29521890E-04     -4.98764472E-04      4.96783392E-04
      1.33000000E+02     -3.02242201E-04     -4.95566014E-04      4.93906335E-04
      1.34000000E+02     -2.72544205E-04     -4.92217990E-04      4.90842375E-04
      1.35000000E+02     -2.38719577E-04     -4.88195427E-04      4.87064954E-04
      1.36000000E+02     -1.99697801E-04     -4.83300147E-04      4.82380718E-04
      1.37000000E+02     -1.56842913E-04     -4.78279047E-04      4.77556026E-04
      1.38000000E+02     -1.12335375E-04     -4.74060129E-04      4.73535786E-04
      1.39000000E+02     -6.74140153E-05     -4.71112345E-04      4.70793958E-04
      1.40000000E+02     -2.24655047E-05     -4.69572353E-04      4.69465560E-04
      1.41000000E+02      2.24655047E-05     -4.69465560E-04      4.69572353E-04
      1.42000000E+02      6.74140153E-05     -4.70793958E-04      4.71112345E-04
      1.43000000E+02      1.12335375E-04     -4.73535786E-04      4.74060129E-04
      1.44000000E+02      1.56842913E-04     -4.77556026E-04      4.78279047E-04
      1.45000000E+02      1.99697801E-04     -4.82380718E-04      4.83300147E-04
      1.46000000E+02      2.38719577E-04     -4.87064954E-04      4.88195427E-04
      1.47000000E+02      2.72544205E-04     -4.90842375E-04      4.92217990E-04
      1.48000000E+02      3.02242201E-04     -4.93906335E-04      4.95566014E-04
      1.49000000E+02      3.29521890E-04     -4.96783392E-04      4.98764472E-04
      1.50000000E+02      3.55448823E-04     -4.99813698E-04      5.02154701E-04
      1.51000000E+02      3.80652891E-04     -5.03210717E-04      5.05953779E-04
      1.52000000E+02      4.05479835E-04     -5.07108230E-04      5.10301327E-04
      1.53000000E+02      4.30025757E-04     -5.11568810E-04      5.15268360E-04
      1.54000000E+02      4.53962080E-04     -5.16506216E-04      5.20781874E-04
      1.55000000E+02      4.76062873E-04     -5.21466460E-04      5.26411609E-04
      1.56000000E+02      4.94133267E-04     -5.25498872E-04      5.31248005E-04
      1.57000000E+02      5.06775625E-04     -5.27805247E-04      5.34544491E-04
      1.58000000E+02      5.15010955E-04     -5.28517111E-04      5.36481517E-04
      1.59000000E+02      5.20482688E-04     -5.28060696E-04      5.37546236E-04
      1.60000000E+02      5.24175266E-04     -5.26621372E-04      5.38017488E-04
      1.61000000E+02      5.26621372E-04     -5.24175266E-04      5.38017488E-04
      1.62000000E+02      5.28060696E-04     -5.20482688E-04      5.37546236E-04
      1.63000000E+02      5.28517111E-04     -5.15010955E-04      5.36481517E-04
      1.64000000E+02      5.27805247E-04     -5.06775625E-04      5.34544491E-04
      1.65000000E+02      5.25498872E-04     -4.94133267E-04      5.31248005E-04
      1.66000000E+02      5.21466460E-04     -4.76062873E-04      5.26411609E-04
      1.67000000E+02      5.16506216E-04     -4.53962080E-04      5.20781874E-04
      1.68000000E+02      5.11568810E-04     -4.30025757E-04      5.15268360E-04
      1.69000000E+02      5.07108230E-04     -4.05479835E-04      5.10301327E-04
      1.70000000E+02      5.03210717E-04     -3.80652891E-04      5.05953779E-04
      1.71000000E+02      4.99813698E-04     -3.55448823E-04      5.02154701E-04
      1.72000000E+02      4.96783392E-04     -3.29521890E-04      4.98764472E-04
      1.73000000E+02      4.93906335E-04     -3.02242201E-04      4.95566014E-04
      1.74000000E+02      4.90842375E-04     -2.72544205E-04      4.92217990E-04
      1.75000000E+02      4.87064954E-04     -2.38719577E-04      4.88195427E-04
      1.76000000E+02      4.82380718E-04     -1.99697801E-04      4.83300147E-04
      1.77000000E+02      4.77556026E-04     -1.56842913E-04      4.78279047E-04
      1.78000000E+02      4.73535786E-04     -1.12335375E-04      4.74060129E-04
      1.79000000E+02      4.70793958E-04     -6.74140153E-05      4.71112345E-04
      1.80000000E+02      4.69465560E-04     -2.24655047E-05      4.69572353E-04
      1.81000000E+02      4.69572353E-04      2.24655047E-05      4.69465560E-04
      1.82000000E+02      4.71112345E-04      6.74140152E-05      4.70793958E-04
      1.83000000E+02      4.74060129E-04      1.12335375E-04      4.73535786E-04
      1.84000000E+02      4.78279047E-04      1.56842913E-04      4.77556026E-04
      1.85000000E+02      4.83300147E-04      1.99697801E-04      4.82380718E-04
      1.86000000E+02      4.88195427E-04      2.38719577E-04      4.87064954E-04
      1.87000000E+02      4.92217990E-04      2.72544205E-04      4.90842375E-04
      1.88000000E+02      4.95566014E-04      3.02242201E-04      4.93906335E-04
      1.89000000E+02      4.98764472E-04      3.29521890E-04      4.96783392E-04
      1.90000000E+02      5.02154701E-04      3.55448823E-04      4.99813698E-04
      1.91000000E+02      5.05953779E-04      3.80652891E-04      5.03210717E-04
      1.92000000E+02      5.10301327E-04      4.05479835E-04      5.07108230E-04
      1.93000000E+02      5.15268360E-04      4.30025757E-04      5.11568810E-04
      1.94000000E+02      5.20781874E-04      4.53962080E-04      5.16506216E-04
      1.95000000E+02      5.26411609E-04      4.76062873E-04      5.21466460E-04
      1.96000000E+02      5.31248005E-04      4.94133267E-04      5.25498872E-04
      1.97000000E+02      5.34544491E-04      5.06775625E-04      5.27805247E-04
      1.98000000E+02      5.36481517E-04      5.15010955E-04      5.28517111E-04
      1.99000000E+02      5.37546236E-04      5.20482688E-04      5.28060696E-04
      2.00000000E+02      5.38017488E-04      5.24175266E-04      5.26621372E-04
      2.01000000E+02      5.38017488E-04      5.26621372E-04      5.24175266E-04
      2.02000000E+02      5.37546236E-04      5.28060696E-04      5.20482688E-04
      2.03000000E+02      5.36481517E-04      5.28517111E-04      5.15010955E-04
      2.04000000E+02      5.34544491E-04      5.27805247E-04      5.06775625E-04
      2.05000000E+02      5.31248005E-04      5.25498872E-04      4.94133267E-04
      2.06000000E+02      5.26411609E-04      5.21466460E-04      4.76062873E-04
      2.07000000E+02      5.20781874E-04      5.16506216E-04      4.53962080E-04
      2.08000000E+02      5.15268360E-04      5.11568810E-04      4.30025757E-04
      2.09000000E+02      5.10301327E-04      5.07108230E-04      4.05479835E-04
      2.10000000E+02      5.05953779E-04      5.03210717E-04      3.80652891E-04
      2.11000000E+02      5.02154701E-04      4.99813698E-04      3.55448823E-04
      2.12000000E+02      4.98764472E-04      4.96783392E-04      3.29521890E-04
      2.13000000E+02      4.95566014E-04      4.93906335E-04      3.02242201E-04
      2.14000000E+02      4.92217990E-04      4.90842375E-04      2.72544205E-04
      2.15000000E+02      4.88195427E-04      4.87064954E-04      2.38719577E-04
      2.16000000E+02      4.83300147E-04      4.82380718E-04      1.99697801E-04
      2.17000000E+02      4.78279047E-04      4.77556026E-04      1.56842913E-04
      2.18000000E+02      4.74060129E-04      4.73535786E-04      1.12335375E-04
      2.19000000E+02      4.71112345E-04      4.70793958E-04      6.74140153E-05
      2.20000000E+02      4.69572353E-04      4.69465560E-04      2.24655047E-05
      2.21000000E+02      4.69465560E-04      4.69572353E-04     -2.24655047E-05
      2.22000000E+02      4.70793958E-04      4.71112345E-04     -6.74140153E-05
      2.23000000E+02      4.73535786E-04      4.74060129E-04     -1.12335375E-04
      2.24000000E+02      4.77556026E-04      4.78279047E-04     -1.56842913E-04
      2.25000000E+02      4.82380718E-04      4.83300147E-04     -1.99697801E-04
      2.26000000E+02      4.87064954E-04      4.88195427E-04     -2.38719577E-04
      2.27000000E+02      4.90842375E-04      4.92217990E-04     -2.72544205E-04
      2.28000000E+02      4.93906335E-04      4.95566014E-04     -3.02242201E-04
      2.29000000E+02      4.96783392E-04      4.98764472E-04     -3.29521890E-04
      2.30000000E+02      4.99813698E-04      5.02154701E-04     -3.55448823E-04
      2.31000000E+02      5.03210717E-04      5.05953779E-04     -3.80652891E-04
      2.32000000E+02      5.07108230E-04      5.10301327E-04     -4.05479835E-04
      2.33000000E+02      5.11568810E-04      5.15268360E-04     -4.30025757E-04
      2.34000000E+02      5.16506216E-04      5.20781874E-04     -4.53962080E-04
      2.35000000E+02      5.21466460E-04      5.26411609E-04     -4.76062873E-04
      2.36000000E+02      5.25498872E-04      5.31248005E-04     -4.94133267E-04
      2.37000000E+02      5.27805247E-04      5.34544491E-04     -5.06775625E-04
      2.38000000E+02      5.28517111E-04      5.36481517E-04     -5.15010955E-04
      2.39000000E+02      5.28060696E-04      5.37546236E-04     -5.20482688E-04
      2.40000000E+02      5.26621372E-04      5.38017488E-04     -5.24175266E-04];

for i=1:length(V(:,1))
    FEM1(i) = V(i,2);
    FEM2(i) = V(i,3);
    FEM3(i) = V(i,4);
end
for i=1:3
    FEM1(i) = V(length(V(:,1))-i+1,2);
    FEM2(i) = V(length(V(:,1))-i+1,3);
    FEM3(i) = V(length(V(:,1))-i+1,4);
end
  
figure
plot(V(:,1),FEM1)
hold on
plot(V(:,1),FEM2)
plot(V(:,1),FEM3)

% For clarity reasons the number of points in the FEM results is reduced
for i=1:81
    FEM31(i) = V(1+(i-1)*3,1)*0.5-0.5;
    FEM32(i) = FEM2(1+(i-1)*3);
end

figure
plot(FEM31,2*FEM32*2000,'o')
hold on
plot(xd4*1000,FEMC)

% The results from the FEM have to be multiplied by 2 because the FEM model
% is establsihed for one pole pitch. The speed for the FEM computations was
% set to 0.5e-3 m/s