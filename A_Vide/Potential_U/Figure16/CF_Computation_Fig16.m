clear all

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% Computation of cogging force using MST %%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% MST : Maxwell stress tensor

load FichInduc

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% Spatial distribution of B components over one pole pair %%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

x0  = [l/2:l:tp-l/2];
x1 = [tp+l/2:l:2*tp-l/2];
for i=1:length(xd)
    for j=1:length(x1)
        Bx(length(x0)+j,i)=-Bx(j,i);
        By(length(x0)+j,i)=-By(j,i);
    end
end

%%%%%%%%%%%%%%%%%%
%%% MST method %%%
%%%%%%%%%%%%%%%%%%
x2  = [l/2:l:2*tp-l/2];
for i=1:length(xd)
    for j=1:length(x2)
        ProdInd(i,j)  = Bx(j,i)*By(j,i);
    end
    ForDet(i)=0;
    for j=1:length(x2)-1
        ForDet(i)  = ForDet(i)+(ProdInd(i,j+1)+ProdInd(i,j))*l/2/mu0;
    end
end

%%%%%%%%%%%%%%%%%%%%%%
%%% Flux2D results %%%
%%%%%%%%%%%%%%%%%%%%%%

FD = [0.00000000E+00      0.00000000E+00
      1.00000000E+00     -5.08599348E+01
      2.00000000E+00     -1.08297091E+02
      3.00000000E+00     -1.80755710E+02
      4.00000000E+00     -2.79971099E+02
      5.00000000E+00     -4.15891238E+02
      6.00000000E+00     -5.68669941E+02
      7.00000000E+00     -7.06655215E+02
      8.00000000E+00     -8.13226186E+02
      9.00000000E+00     -8.87349569E+02
      1.00000000E+01     -9.32824029E+02
      1.10000000E+01     -9.53730309E+02
      1.20000000E+01     -9.53393272E+02
      1.30000000E+01     -9.33723661E+02
      1.40000000E+01     -8.93806220E+02
      1.50000000E+01     -8.26181478E+02
      1.60000000E+01     -7.19369080E+02
      1.70000000E+01     -5.73051380E+02
      1.80000000E+01     -3.97125876E+02
      1.90000000E+01     -2.02897294E+02
      2.00000000E+01     -6.68733957E-11
      2.10000000E+01      2.02897294E+02
      2.20000000E+01      3.97125876E+02
      2.30000000E+01      5.73051380E+02
      2.40000000E+01      7.19369080E+02
      2.50000000E+01      8.26181478E+02
      2.60000000E+01      8.93806220E+02
      2.70000000E+01      9.33723661E+02
      2.80000000E+01      9.53393272E+02
      2.90000000E+01      9.53730309E+02
      3.00000000E+01      9.32824029E+02
      3.10000000E+01      8.87349569E+02
      3.20000000E+01      8.13226186E+02
      3.30000000E+01      7.06655215E+02
      3.40000000E+01      5.68669941E+02
      3.50000000E+01      4.15891238E+02
      3.60000000E+01      2.79971099E+02
      3.70000000E+01      1.80755710E+02
      3.80000000E+01      1.08297091E+02
      3.90000000E+01      5.08599348E+01
      4.00000000E+01      8.52200102E-10];

figure
plot(FD(:,1)*0.5,FD(:,2)*2,'o')
hold on
plot(xd*1000,ForDet)

% The results from the FEM have to be multiplied by 2 because the FEM model
% is establsihed for one pole pitch